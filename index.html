<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>sx86 Emulator and Assembler</title>
    <meta name="description" content="Personal website of Christopher J. Woodall. Electrical Engineer, student at Boston University, technician at Electronic Design Facility (EDF), vice-president of BUILDS and Electronics Lead of BU Rocket Propulsion Group.">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="css/bootstrap.min.css">

    <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="css/main.css">

    <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
  </head>
  <body style="overflow:auto" data-spy="scroll" data-target=".navbar">
    <!--[if lt IE 7]>
        <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

    <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>

          <a class="brand" href="#">sx86 Emulator</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right" id="navbar">
              <li><a href="https://github.com/cwoodall/sx86-emulator">Github</a></li>
              <li><a href="http://www.builds.cc">Provided by <span style="color:red">BU</span><span style="color:white">ILDS</span></a></li> 
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row-fluid">
        <div class="span8">
            <div class="tab-pane active" id="mem_tab">
              <h2>Memory</h2>
              <div id="sx86_ram"></div>
            </div>
        </div>

        <div class="span4">
          <div id="actions">
            <h2>Actions</h2>
            <div class="btn-group txt-center" id="action_btns">
              <a id="run_btn"    class="btn btn-small">Run (Slow)</a>
							<a id="run_fast_btn"    class="btn btn-small">Run (Fast)</a>
              <a id="stop_btn"   class="btn btn-small">Stop</a>
              <a id="next_btn"   class="btn btn-small">Next</a>
              <a id="reload_btn" class="btn btn-small">Reload</a>
              <a id="clear_btn"  class="btn btn-small">Clear</a>
            </div>
          </div>

          <div class="row-fluid">
          </div>
          <br />
          <div class="row-fluid tabbable"> <!-- Only required for left/right tabs -->
            <ul class="nav nav-tabs">
              <li class="active">
                <a href="#tab1" data-toggle="tab">Load Code</a>
              </li>

              <li>
                <a href="#tab2" data-toggle="tab">Monitor Registers</a>
              </li>
              <li>
                <a href="#tab3" data-toggle="tab">Help</a>
              </li>
            </ul>

            <div class="tab-content">
              <div class="tab-pane active" id="tab1">
                <div id="program_stuff">
                  <h2>Machine Code</h2>
                  <div class="row-fluid">
                    <textarea style="font-family:monospace;height:80px;width:90%" id="program_load">900A904B9094B001A0011001800230229013C0C01003B003C0C01003B0030000
                    </textarea>
                  </div>
                  <div class="btn-group txt-center" >

                    <a id="load_program_btn" class="btn btn-primary text-right">
                      Load Program
                    </a>

                    <a id="disassemble_btn" class="btn btn-primary text-right">
                      Disassemble
                    </a>
                  </div>  
                </div>

                <div id="assembly_stuff">
                  <h2>Assembly Code</h2>
                  <div class="row-fluid">
                    <textarea style="font-family:monospace;height:80px;width:90%" id="assembly_string"></textarea>
                  </div>
                  <div class="btn-group txt-center">
                    <a id="assemble_btn" class="btn btn-primary">
                      Assemble!
                    </a>
                  </div>
                </div>

              </div>
              <div class="tab-pane" id="tab2">
                <h2>Registers</h2>
                <div id="sx86_reg"></div>
                <hr/>

                <h2>Memory Values</h2>
                <p>
                  <span class="bold">Clicked Value [<span id="ram_clicked_cellID"></span>]-</span> <span id="ram_clicked_cellDisp"></span>
                </p>
           
                <p>
                  <span class="bold">Hovering Value [<span id="ram_mouseover_cellID"></span>]-</span> <span id="ram_mouseover_cellDisp"></span>
                </p>
              </div>
              <div class="tab-pane" id="tab3">
                <h2>Help</h2>
                <p>Help text</p>
              </div>
            </div>
          </div>
        </div>          
      </div>
      
      <hr />
      <footer style="height:auto">
        <div class="row-fluid">
          <div class="span4"><p>&copy; <a href="http://www.cjwoodall.com" target="_blank">Christopher Woodall</a> 2013 and released under <a href="http://opensource.org/licenses/MIT" target="_blank">The MIT License</a></p></div>

          <div class="span4 txt-center">Provided by <a href="http://www.builds.cc">BUILDS</a></div>
          <div class="span4 push-right"><p class="txt-right">Powered by <a href="http://twitter.github.com/bootstrap">Bootstrap</a></p></div>
        </div>
      </footer>
    </div> <!-- /container -->
    
    <script src="js/vendor/jquery-1.10.2.min.js"></script>
    <script src="js/vendor/bootstrap.min.js"></script>


    <script type="text/javascript" src="js/sx86.js"></script>
    <script type="text/javascript" src="js/sx86-display.js"></script>
    <script type="text/javascript"> 
      var LoadProgram = function(){
        program = [];
        var textarea = document.getElementById("program_load");
        program = textarea.value.match(/.{1,4}/g);
        for (var i = 0; i < program.length; i++) {
          if ((program[i] !== '') || (program[i] !== ' ') || (program[i] !== '\n')) {
            program[i] = parseInt(program[i],16);
          }
        }
        sx86.clear()
        sx86_display.load_program(program);
      };

    $(document).ready(function(){
      sx86.initialize();
      sx86_display.init_ram_display($("#sx86_ram"));   
      sx86_display.init_reg_display($("#sx86_reg"));
      LoadProgram();
      sx86_display.update_display();

      $("#run_btn").on("click", function () {
        sx86_display.run(400);
      });

      $("#run_fast_btn").on("click", function () {
        sx86_display.run(0);
      });
  
      $("#stop_btn").on("click", function () {
        sx86_display.stop();
      });

      $("#clear_btn").on("click", function () {
        sx86_display.stop();

        sx86.clear();
        sx86_display.update_display();
      });
  
      $("#next_btn").on("click", function () {
        sx86_display.stop();
        sx86_display.next_step_update_display();
      });

      $("#reload_btn").on("click", function () {
        sx86_display.stop();

        sx86.clear()
        sx86_display.load_program(sx86_display.current_program);
        sx86_display.update_display();
      });
    
      $("#load_program_btn").on("click", function () {
        sx86_display.stop();

        LoadProgram();
        sx86_display.update_display();

      });

      $("#assemble_btn").click(function () {
        req = {'assembly_string': $("#assembly_string").val()};
        $.post('/cgi-bin/sx86-assembler.py', req, function(resp) {
          $("#program_load").val(resp);
        })
      });

      $("#disassemble_btn").click(function () {
        req = {'machinecode': $("#program_load").val()};
        $.post('/cgi-bin/sx86-disassembler.py', req, function(resp) {
          $("#assembly_string").val(resp)
        });
      });
      
      $(".ram_td").click(function () {
        ram_index = parseInt(this.id.split('_')[2]); // Get the index of the register of format sx86_reg_index
        sx86_display.clicked_index = ram_index;
        if (sx86.mem.ram[sx86_display.clicked_index] >= 0) {
          $("#ram_clicked_cellDisp").html("0x" + sx86.mem.ram[sx86_display.clicked_index].toString(16));
        } else {
          $("#ram_clicked_cellDisp").html("0x****");
        }
        $("#ram_clicked_cellID").html("0x" + sx86_display.clicked_index.toString(16));

      });

      $(".ram_td").hover(function () {
        ram_index = parseInt(this.id.split('_')[2]); // Get the index of the register of format sx86_reg_index
        sx86_display.hover_index = ram_index
        if (sx86.mem.ram[sx86_display.hover_index] >= 0) {
          $("#ram_mouseover_cellDisp").html("0x" + sx86.mem.ram[sx86_display.hover_index].toString(16));
        } else {
          $("#ram_mouseover_cellDisp").html("0x****");
        }
        $("#ram_mouseover_cellID").html("0x" + sx86_display.hover_index.toString(16));

      });
    });
    </script>
<!--    <script type="text/javascript" src="js/main.js"></script> -->

  </body>
</html>
